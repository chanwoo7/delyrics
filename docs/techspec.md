# 가사 중복 제거기 macOS 앱 구현 요구사항

## 1. 개요

본 문서는 **가사 텍스트를 줄 단위로 중복 제거**해주는 **macOS 전용 GUI 데스크톱 앱**의 구현 요구사항을 정의한다.

이 앱은 사용자가 여러 줄의 가사를 입력(또는 붙여넣기)하면,  
각 줄을 위에서부터 순서대로 검사하여 **이미 등장한 내용과 중복되는 줄은 제거**하고,  
**최초 등장한 줄만 유지한 결과**를 출력해야 한다.

이 앱은 **로컬에서만 동작**하며, 서버 통신 없이 모든 처리를 클라이언트 내부에서 수행한다.

---

## 2. 목표

- 사용자가 가사를 텍스트 영역에 붙여넣고, 버튼 클릭 또는 `Command + Enter`로 변환할 수 있어야 한다.
- 줄 단위 중복 제거 로직은 **공백(띄어쓰기, 탭, 줄 앞뒤 공백 등)을 무시한 비교 기준**을 사용해야 한다.
- 중복 제거 결과는 별도의 출력 영역에 즉시 표시되어야 한다.
- 결과를 쉽게 복사할 수 있어야 한다.
- macOS에서 자연스럽게 동작하는 Flutter 기반 GUI 앱으로 구현해야 한다.

---

## 3. 기술 요구사항

## 3.1 플랫폼
- **macOS 전용 앱**으로 구현한다.
- 초기 릴리스는 macOS만 지원하며, iOS/Windows/Linux/Web은 고려하지 않는다.

## 3.2 프레임워크
- **Flutter (Desktop)** 를 사용한다.
- 언어는 **Dart**를 사용한다.

## 3.3 처리 방식
- 모든 텍스트 처리는 로컬에서 수행한다.
- 외부 API 호출, 로그인, 네트워크 요청, 데이터베이스는 사용하지 않는다.

## 3.4 구현 원칙
- 핵심 중복 제거 로직은 UI 코드와 분리된 **순수 함수**로 작성한다.
- 추후 테스트가 가능하도록 로직 레이어를 분리한다.
- 유지보수성을 위해 과도한 단일 파일 구현을 피하고, 최소한의 구조 분리를 한다.

---

## 4. 핵심 기능 요구사항

## 4.1 입력
- 사용자는 **여러 줄 텍스트를 입력/붙여넣기**할 수 있어야 한다.
- 입력 영역은 여러 줄 편집이 가능해야 한다.
- 긴 가사를 붙여넣어도 정상 동작해야 한다.
- 빈 줄이 포함되어 있어도 앱이 오류 없이 동작해야 한다.

## 4.2 변환 트리거
사용자는 아래 두 방식 중 하나로 변환을 실행할 수 있어야 한다.

1. **변환 버튼 클릭**
2. **`Command + Enter` 단축키 입력**

추가 조건:
- 일반 `Enter` 키는 줄바꿈으로 동작해야 하며, 변환 트리거가 되어서는 안 된다.
- `Command + Enter` 입력 시 현재 입력값 기준으로 즉시 변환이 실행되어야 한다.

## 4.3 중복 제거 규칙
앱은 입력 텍스트를 **줄 단위**로 순회하며, 다음 규칙으로 중복을 판단해야 한다.

### 기본 규칙
- 각 줄을 위에서부터 순서대로 검사한다.
- 이전에 이미 등장한 줄과 **동일하다고 판정되면** 해당 줄은 제거한다.
- 최초 등장한 줄은 유지한다.
- 결과 출력 시 **원래 처음 등장한 원문 그대로** 보여준다.

### 동일 판정 규칙
두 줄은 아래 조건을 만족하면 같은 줄로 간주한다.

- 줄 내부의 **모든 공백 문자**를 제거했을 때 문자열이 같으면 중복이다.

공백 문자에는 다음이 포함된다.
- 일반 공백(space)
- 탭(tab)
- 줄 앞뒤 공백(trim 대상)
- 연속 공백

즉, 비교용 키는 “해당 줄에서 모든 공백 문자를 제거한 문자열”이다.

### 예시
아래 두 줄은 중복으로 간주해야 한다.

```text
오직 내 삶에 오직 내 맘에 그가 주인 되셨네
```

```text
오직 내삶에 오직 내 맘에 그가 주인되셨네
```

이유:
- 공백 제거 후 두 줄 모두 동일한 문자열이 되기 때문이다.

## 4.4 출력
- 결과는 별도의 **출력 영역**에 표시해야 한다.
- 출력 순서는 **최초 등장 순서**를 유지해야 한다.
- 출력 텍스트는 줄바꿈 구조를 유지해야 한다.
- 빈 줄은 기본적으로 제거한다. (즉, 출력에 불필요한 빈 줄은 포함하지 않는다.)

## 4.5 결과 복사
- 사용자는 **결과 복사 버튼**을 통해 출력 결과를 클립보드에 복사할 수 있어야 한다.
- 복사 성공 시 간단한 피드백(예: 토스트, 스낵바, 상태 메시지 등)을 표시한다.

## 4.6 초기화
- 사용자는 **입력/출력 전체 초기화 버튼**을 통해 앱 상태를 리셋할 수 있어야 한다.
- 초기화 시 입력 영역과 출력 영역이 모두 비워져야 한다.

---

## 5. UI/UX 요구사항

## 5.1 기본 레이아웃
앱은 아래 구성 요소를 포함해야 한다.

1. 앱 제목
2. 입력 영역 (원본 가사)
3. 액션 버튼 영역
4. 출력 영역 (중복 제거 결과)
5. 상태/보조 정보 영역 (선택)

권장 레이아웃:
- 상단: 앱 제목
- 중단: 입력 텍스트 영역
- 입력 영역 아래: 버튼들
- 하단: 출력 텍스트 영역

## 5.2 버튼 구성
최소 다음 버튼들을 제공한다.

- **변환**
- **결과 복사**
- **초기화**

필요 시 추가 가능:
- **입력 붙여넣기**
- **출력 선택 전체**

단, 필수는 아니다.

## 5.3 사용성
- 입력/출력 텍스트 영역은 충분히 넓어야 한다.
- 창 크기 변경 시 텍스트 영역이 함께 유연하게 늘어나도록 한다.
- 앱 첫 실행 시 곧바로 입력할 수 있도록 입력 영역에 포커스가 가는 것이 바람직하다.
- macOS 데스크톱 환경에 어울리는 단순하고 깔끔한 UI를 지향한다.
- 과한 애니메이션이나 불필요한 장식은 피한다.

## 5.4 상태 표시
다음과 같은 보조 정보를 표시하면 좋다.

- 입력 줄 수
- 출력 줄 수
- 제거된 중복 줄 수

예:
- 입력 20줄 / 출력 10줄 / 중복 제거 10줄

---

## 6. 상세 동작 정의

## 6.1 입력 파싱
- 입력 텍스트를 줄바꿈 기준으로 분리한다.
- 각 줄은 처리 전에 최소한의 정리를 수행한다.
- 줄이 완전히 비어 있으면 무시한다.

## 6.2 비교용 정규화
각 줄에 대해 다음 비교용 정규화를 수행한다.

1. 줄의 앞뒤 공백 제거
2. 줄 내부의 모든 공백 문자 제거
3. 그 결과 문자열을 중복 판정 키로 사용

예:
- 원문: `  오직 내 삶에   오직 내 맘에 그가 주인 되셨네  `
- 비교용 키: `오직내삶에오직내맘에그가주인되셨네`

## 6.3 출력 보존 규칙
- 중복이 아닌 것으로 처음 통과한 줄은 **정리된 표시용 문자열**로 결과에 저장한다.
- 여기서 “정리된 표시용 문자열”은 **앞뒤 공백만 제거한 원문**을 의미한다.
- 즉, 내부 공백은 원문 그대로 유지한다.
- 따라서 사용자는 첫 등장한 줄의 원래 형태를 최대한 유지한 결과를 보게 된다.

## 6.4 예외 처리
- 입력이 비어 있으면 변환 시 오류를 내지 말고, 빈 결과를 출력하거나 안내 메시지를 표시한다.
- 매우 긴 텍스트가 들어와도 UI가 멈추지 않도록 구현한다. 다만 초기 버전에서는 일반적인 가사 길이 기준으로 충분히 빠르게 동작하면 된다.
- 예외 발생 시 앱이 종료되지 않도록 방어적으로 처리한다.

---

## 7. 예시 입출력

## 7.1 입력 예시

```text
주 안에서 내 영혼 다시 태어나
이전 것은 지나고 새롭게 됐네
죄로 물든 내 모습 예수와 함께 죽고
부활 생명 내 안에 새로운 삶이 열렸네
너희가 나를 택한 것이 아니요
내가 너희를 택하여 세웠나니
오직 내 안에 오직 내 속에 그리스도가 사네
오직 내 삶에 오직 내 맘에 그가 주인 되셨네
죄로 물든 내 모습 예수와 함께 죽고
부활 생명 내 안에 새로운 삶이 열렸네
너희가 나를 택한 것이 아니요
내가 너희를 택하여 세웠나니
오직 내 안에 오직 내 속에 그리스도가 사네
오직 내삶에 오직 내 맘에 그가 주인되셨네
내 생명 그 안에 그의 생명 내 안에
나의 삶이 이전과 같을 수 없네
내 생명 그 안에 그의 생명 내 안에
나의 삶이 이전과 같을 수 없네
오직 내 안에 오직 내 속에 그리스도가 사네
오직 내 삶에 오직 내 맘에 그가 주인 되셨네
```

## 7.2 기대 출력 예시

```text
주 안에서 내 영혼 다시 태어나
이전 것은 지나고 새롭게 됐네
죄로 물든 내 모습 예수와 함께 죽고
부활 생명 내 안에 새로운 삶이 열렸네
너희가 나를 택한 것이 아니요
내가 너희를 택하여 세웠나니
오직 내 안에 오직 내 속에 그리스도가 사네
오직 내 삶에 오직 내 맘에 그가 주인 되셨네
내 생명 그 안에 그의 생명 내 안에
나의 삶이 이전과 같을 수 없네
```

---

## 8. 비기능 요구사항

## 8.1 성능
- 일반적인 가사 텍스트(수십 줄 ~ 수백 줄) 기준으로 즉시 처리되어야 한다.
- 중복 제거 버튼 클릭 후 체감 지연이 거의 없어야 한다.

## 8.2 안정성
- 빈 입력, 공백만 있는 입력, 긴 입력 등에서도 앱이 크래시하지 않아야 한다.

## 8.3 유지보수성
- 핵심 로직은 별도 파일/모듈로 분리한다.
- UI와 로직 간 책임 분리를 유지한다.
- 향후 “특수문자 무시”, “대소문자 무시”, “반복 구간 탐지” 등의 확장이 가능하도록 구조를 과하게 막지 않는다.

## 8.4 의존성 최소화
- 불필요한 외부 패키지는 최대한 사용하지 않는다.
- Flutter 기본 기능으로 충분한 경우 기본 기능을 우선 사용한다.
- 클립보드는 Flutter 기본 API 사용을 우선 검토한다.

---

## 9. 권장 구현 구조

아래는 권장 구조이며, 동일한 책임 분리가 보장된다면 세부 파일명은 조정 가능하다.

```text
lib/
  main.dart
  app.dart
  features/
    lyrics_deduper/
      presentation/
        pages/
          home_page.dart
        widgets/
          lyrics_input_panel.dart
          lyrics_output_panel.dart
          action_buttons.dart
          status_bar.dart
      domain/
        services/
          lyrics_dedupe_service.dart
        models/
          dedupe_result.dart
```

### 구조 원칙
- `presentation`: 화면/위젯
- `domain/services`: 중복 제거 핵심 로직
- `models`: 처리 결과 DTO 성격의 모델 (예: 입력 줄 수, 출력 줄 수, 중복 제거 수, 결과 문자열)

---

## 10. 권장 구현 상세

## 10.1 핵심 서비스
핵심 서비스는 대략 아래 역할을 가져야 한다.

- 입력 문자열 수신
- 줄 단위 분리
- 공백 무시 기준으로 중복 제거
- 결과 문자열 및 통계 정보 반환

예상 반환 정보:
- `outputText`
- `inputLineCount`
- `outputLineCount`
- `removedDuplicateCount`

## 10.2 단축키 처리
- `Command + Enter`를 전역이 아닌, **입력 화면 문맥에서 자연스럽게 작동**하도록 구현한다.
- 입력 중 `Command + Enter` 시 변환 버튼과 동일한 동작을 수행한다.

## 10.3 상태 관리
초기 버전은 다음 중 단순한 방식으로 충분하다.

- `StatefulWidget`
- `ValueNotifier`
- 가벼운 상태 관리 방식

앱 규모가 작으므로 과도한 상태 관리 라이브러리 도입은 지양한다.

---

## 11. 테스트 요구사항

최소한 아래 테스트를 구현한다.

## 11.1 단위 테스트
핵심 중복 제거 로직에 대한 단위 테스트를 작성한다.

테스트 케이스 예:
1. 완전 동일한 줄 중복 제거
2. 공백만 다른 줄 중복 제거
3. 앞뒤 공백이 있는 경우 정상 처리
4. 빈 줄 제거
5. 순서 보존 확인
6. 입력이 비어 있을 때 빈 결과 반환

## 11.2 위젯 테스트 (선택)
가능하면 아래 수준의 위젯 테스트를 추가한다.

- 텍스트 입력 후 변환 버튼 클릭 시 결과가 표시되는지
- 초기화 버튼 클릭 시 입력/출력이 비워지는지

---

## 12. 산출물 요구사항

구현 완료 시 아래 항목을 포함한다.

1. 실행 가능한 Flutter macOS 앱 프로젝트
2. 핵심 로직 단위 테스트
3. 간단한 `README.md`

`README.md`에는 최소한 아래 내용을 포함한다.
- 실행 방법
- macOS 빌드 방법
- 사용 방법
- 단축키 (`Command + Enter`)
- 중복 판정 규칙 설명 (공백 무시)

---

## 13. 제외 범위

이번 버전에서는 아래 기능은 구현 범위에서 제외한다.

- 파일 열기/저장 기능
- 자동 저장
- 다크모드 커스텀 테마
- iCloud 연동
- 네트워크 동기화
- OCR
- 여러 문서 탭
- 가사 외 다른 포맷 분석
- AI 기능

---

## 14. 완료 기준

아래 조건을 모두 만족하면 완료로 본다.

1. macOS에서 Flutter 앱이 정상 실행된다.
2. 사용자가 여러 줄 가사를 붙여넣을 수 있다.
3. 버튼 클릭 또는 `Command + Enter`로 변환된다.
4. 공백을 무시한 기준으로 줄 중복이 제거된다.
5. 첫 등장한 줄의 형태를 유지한 결과가 출력된다.
6. 결과 복사가 정상 동작한다.
7. 초기화가 정상 동작한다.
8. 핵심 로직 테스트가 포함된다.
9. README가 포함된다.

---

## 15. 구현 시 주의사항

- 핵심 로직은 반드시 UI와 분리한다.
- 비교용 문자열과 출력용 문자열을 혼동하지 않는다.
- 출력은 “공백 제거된 문자열”이 아니라 **첫 등장 원문의 표시용 형태(앞뒤 공백만 정리한 값)** 여야 한다.
- `Enter` 단독 입력은 줄바꿈이어야 한다.
- `Command + Enter`만 변환 트리거로 동작해야 한다.
- 앱은 작고 단순해야 하며, 불필요한 아키텍처 과설계를 피한다.

---

## 16. 구현 요청

위 요구사항을 만족하는 **Flutter 기반 macOS 전용 데스크톱 앱**을 구현한다.

구현 시 다음을 함께 수행한다.

- 적절한 프로젝트 구조 구성
- 핵심 로직 분리
- 테스트 작성
- README 작성

최종 결과는 바로 실행/수정 가능한 형태의 소스코드로 제공한다.